#Pre-FTL colony ship
#By ViolentBeetle
#Idea by r/GarlicBow

namespace = mem_colony_ship

#Gatekeeper event
country_event = {
	id = mem_colony_ship.1
	hide_window = yes
	
	mean_time_to_happen = {
		months = 2500
	}
	
	trigger = {
		NOT = { has_global_flag = mem_colony_ship_started }
		NOT = { has_country_flag = mem_colony_ship_rolled }
		is_ai = no
		is_country_type = default
		any_system_within_border = {
			NOT = {
				any_planet = { is_owned_by = root }
			}
			any_planet = {
				is_colonizable = yes
				NOR = {
					exists = owner
					is_planet_class = pc_gaia
					is_planet_class = pc_habitat
					is_planet_class = pc_ringworld_habitable
					is_planet_class = pc_nuked
					has_planet_flag = colony_event
				}
			}
		}
	}
	
	immediate = {
		set_country_flag = mem_colony_ship_rolled
		random_list = {
			0 = {  }
			35 = {
				country_event = { id = mem_colony_ship.2 }
			}
		}
	}
}

#Proximity Alert!
country_event = {
	id = mem_colony_ship.2
	title = mem_colony_ship.2.name
	desc = mem_colony_ship.2.desc
	
	is_triggered_only = yes
	
	picture = GFX_evt_fleet_neutral
	show_sound = event_red_alert
	location = event_target:the_system
	
	immediate = {
		set_global_flag = mem_colony_ship_started
		random_system_within_border = {
			limit = {
				NOT = {
					any_planet = { is_owned_by = root }
				}
				any_planet = {
					is_colonizable = yes
					NOR = {
						exists = owner
						is_planet_class = pc_gaia
						is_planet_class = pc_habitat
						is_planet_class = pc_ringworld_habitable
						is_planet_class = pc_nuked
						has_planet_flag = colony_event
					}
				}	
			}
			save_event_target_as = the_system
			random_system_planet = {
				limit = {
					is_colonizable = yes
					NOR = {
						exists = owner
						is_planet_class = pc_gaia
						is_planet_class = pc_habitat
						is_planet_class = pc_ringworld_habitable
						is_planet_class = pc_nuked
						has_planet_flag = colony_event
					}
				}
				save_event_target_as = the_planet
			}
		}
		random_list = {
			75 = {
				create_species = {
					name = random
					class = random_non_machine
					portrait = random
					homeworld = event_target:the_planet
					traits = {
						trait = random_traits
					}
				}
			}
			25 = {
				set_global_flag = mem_colony_ship_is_humans
				create_species = {
					name = Human
					plural = Humans
					class = "HUM"
					portrait = "human"
					homeworld = event_target:the_planet
					traits = {
						trait = "trait_adaptive"
						trait = "trait_nomadic"	
						trait = "trait_wasteful"
					}
				}
				modifier = { #If humans or sol already exist, must not happen
					factor = 0
					OR = {
						any_country = {
							any_owned_pop_species = { species_portrait = human } 
						}
						any_system = {
							has_star_flag = sol
						}
					}
				}
			}
		}
		create_country = {
			name = "Unidentified Interlopers"
			type = neutral_faction
			species = last_created_species
			effect = {
				establish_communications_no_message = root
			}
			auto_delete = no
			flag = {
				icon={
					category = "zoological"
					file = "flag_zoological_14.dds"
				}
				background = {
					category = "backgrounds"
					file = "circle.dds"
				}
				colors = {
					"turquoise"
					"dark_blue"
					"null"
					"null"
				}
			}
		}
		last_created_country = { save_event_target_as = interloper_country }
		create_fleet = {
			name = "NAME_MEM_Unidentified_Vessel_Fleet"
			effect = {
				set_owner = event_target:interloper_country
				set_fleet_flag = mem_colony_ship_interloper_fleet
				create_ship = {
					name = "NAME_MEM_Unidentified_Vessel_Name"
					design = "NAME_MEM_Unidentified_Vessel"
				}
				set_location = {
					target = event_target:the_system.star
					distance = 120
					angle = random
				}
				fleet_event = {
					id = mem_colony_ship.3
					days = 15
				}
			}
		}
	}
	
	option = {
		name = mem_colony_ship.2.a
	}
	
	option = {
		name = mem_colony_ship.2.b
		
		set_faction_hostility = {
			target = event_target:interloper_country
			set_hostile = yes
			set_neutral = no
			set_friendly = no
		}
	}
}

#Fleet begins its movement towards the planet
fleet_event = {
	id = mem_colony_ship.3
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		clear_fleet_actions = yes
		queue_actions = {
			move_to = event_target:the_planet
			orbit_planet = event_target:the_planet
			effect = {
				id = mem_colony_ship.ship_trigger.1
				event_target:the_planet = {
					planet_event = { id = mem_colony_ship.4 }
				}
			}
		}
	}
}

#On arrival, gonna need to see what do
planet_event = {
	id = mem_colony_ship.4
	hide_window = yes
	is_triggered_only = yes
}