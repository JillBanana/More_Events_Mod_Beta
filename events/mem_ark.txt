#The Ark
#By ViolentBeetle

namespace = mem_ark

#When you surveyed the planet

#Invisible event to trigger on surveying planet with station
ship_event = {
    id = mem_ark.1
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        owner = {
            is_country_type = default
        }
        NOT = { has_global_flag = mem_ark_finished }
        FROM = {
            has_planet_flag = mem_ark_homeworld
            exists = owner
            owner = {
                is_country_type = primitive
            }
        }
    }

    immediate = {
        FROM = {
            save_event_target_as = the_planet
        }
        owner = {
            country_event = { id = mem_ark.2 days = 14 }
        }
    }
}

#Issuing of chains
country_event = {
    id = mem_ark.2
    title = mem_ark.2.name
    desc = mem_ark.2.desc

    is_triggered_only = yes

    picture = GFX_evt_satellite_in_orbit
    location = event_target:the_planet

    trigger = {
        NOT = { has_global_flag = mem_ark_finished }
        event_target:the_planet = {
            exists = owner
            owner = {
                is_country_type = primitive
            }
        }
    }

    option = {
        name = mem_ark.2.a

        enable_special_project = {
            name = MEM_ARK_PROJECT
            location = event_target:the_planet
            owner = root
        }

        ai_chance = {
            factor = 1000
        }
    }

    option = {
        name = NOTIME

        add_influence = 30
    }
}

#Project completed
ship_event = {
    id = mem_ark.3
    title = mem_ark.3.name
    desc = mem_ark.3.desc

    is_triggered_only = yes

    picture = GFX_evt_satellite_in_orbit
    location = event_target:the_planet

    option = {
        name = mem_ark.3.a
        custom_tooltip = mem_ark.3.a.tooltip

        ai_chance = {
            factor = 1
            modifier = {
                factor = 100
                owner = { 
                    OR = {
                        is_xenophile = yes
                        has_valid_civic = civic_machine_servitor
                    }    
                }
            }
        }

        IF = {
            limit = {
                owner = { 
                    OR = {
                        is_xenophile = yes
                        has_valid_civic = civic_machine_servitor
                    }    
                }
            }
            owner = {
                add_monthly_resource_mult = {
                    resource = unity
                    value = @tier3unityreward
                    min = @tier3unitymin
                    max = @tier3unitymax
                }
            }
        }
        ELSE_IF = {
            limit = {
                owner = {
                    NOR = {
                        is_xenophobe = yes
                        has_civic = civic_machine_terminator
                        has_civic = civic_hive_devouring_swarm
                    }
                }
            }
            owner = {
                add_monthly_resource_mult = {
                    resource = unity
                    value = @tier1unityreward
                    min = @tier1unitymin
                    max = @tier1unitymax
                }
            }
        }

        hidden_effect = {
            every_country = {
                limit = {
                    has_special_project = MEM_ARK_PROJECT
                }
                abort_special_project = {
                    type = MEM_ARK_PROJECT
                    location = event_target:the_planet
                }
            }
            IF = {
                limit = {
                    NOT = { has_global_flag = mem_ark_finished }
                }
                owner = {
                    set_country_flag = mem_ark_releaser
                    save_event_target_as = releaser_country
                }
                event_target:the_planet = {
                    random_tile = {
                        limit = { has_pop = no }
                        create_pop = { species = event_target:mem_ark_sky_people }
                    }
                }
                set_global_flag = mem_ark_finished
                destroy_ambient_object = event_target:mem_ark_station
            }
        }
    }

    option = {
        name = mem_ark.3.b

        owner = { add_influence = 50 }

        ai_chance = {
            factor = 0
        }
    }

    option = {
        name = mem_ark.3.c

        ai_chance = {
            factor = 1
            modifier = {
                factor = 100
                owner = {
                    OR = {
                        has_ethic = ethic_gestalt_consciousness
                        has_ethic = ethic_fanatic_xenophobe
                        has_ethic = ethic_xenophobe
                        has_ethic = ethic_fanatic_materialist
                        has_ethic = ethic_materialist
                    }
                    is_xenophile = no
                    NOT = {
                        has_civic = civic_machine_servitor
                    }
                }
            }
        }

        trigger = {
            owner = {
                OR = {
                    has_ethic = ethic_gestalt_consciousness
                    has_ethic = ethic_fanatic_xenophobe
                    has_ethic = ethic_xenophobe
                    has_ethic = ethic_fanatic_materialist
                    has_ethic = ethic_materialist
                }
                is_xenophile = no
                NOT = {
                    has_civic = civic_machine_servitor
                }
            }
        }

        owner = {
            add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
            }
            add_monthly_resource_mult = {
				resource = society_research
				value = @tier2researchreward
				min = @tier2researchmin
				max = @tier2researchmax
			}
        }
    }
}

