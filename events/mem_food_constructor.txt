# Reesan Food Constructor

namespace = mem_food_constructor

# Step 1: Found food constructor
planet_event = {
	id = mem_food_constructor.1
	title = "mem_food_constructor.1.name"
	desc = "mem_food_constructor.1.desc"
	picture = GFX_evt_mem_strange_apparatus
	location = ROOT
	
	trigger = {
		has_owner = yes
		original_owner = yes
		#is_homeworld = no
		owner = { is_ai = no }
		has_ground_combat = no
		num_pops > 0
		#is_capital = no
		is_ringworld = no
		NOR = {
			is_planet_class = pc_gaia
			is_planet_class = pc_habitat
			is_planet_class = pc_shrouded
			
			has_global_flag = mem_food_constructor_global
			has_planet_flag = colony_event
			
		}
	}
	
	immediate = {
		set_planet_flag = mem_food_constructor_step1
		set_planet_flag = colony_event
		set_global_flag = mem_food_constructor_global
		solar_system = {
			set_star_flag = mem_food_constructor_home
		}
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	option = {
		name = mem_food_constructor.1a
		
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_fanatic_xenophile
					has_ethic = ethic_xenophile
					has_ethic = ethic_fanatic_militarist
					has_ethic = ethic_militarist
					has_ethic = ethic_fanatic_spiritualist
					has_ethic = ethic_spiritualist
					has_ethic = ethic_fanatic_xenophobe
					has_ethic = ethic_xenophobe				
				}
			}
		}
		
		add_modifier = {
			modifier = mem_food_constructor_modifier_1
			days = -1
		}
	}
	
	option = {
		name = mem_food_constructor.1b
		
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_xenophile
					has_ethic = ethic_xenophile
				}
			}
		}
		
		add_modifier = {
			modifier = mem_food_constructor_modifier_1
			days = -1
		}
	}
	
	option = {
		name = mem_food_constructor.1c
		
		trigger = {
			owner = {
			
				OR = {
					has_ethic = ethic_fanatic_militarist
					has_ethic = ethic_militarist
				}
			}
		}
		
		add_modifier = {
			modifier = mem_food_constructor_modifier_1
		}
	}
	
	option = {
		name = mem_food_constructor.1d
		
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_spiritualist
					has_ethic = ethic_spiritualist
				}
			}
		}
		
		add_modifier = {
			modifier = mem_food_constructor_modifier_1
			days = -1
		}
	}
	
	option = {
		name = mem_food_constructor.1e
		
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_xenophobe
					has_ethic = ethic_xenophobe				
				}
			}
		}
		
		add_modifier = {
			modifier = mem_food_constructor_modifier_1
			days = -1
		}
	}
}

#Step 2: Troubles begin
planet_event = {
	id = mem_food_constructor.2
	title = "mem_food_constructor.2.name"
	desc = "mem_food_constructor.2.desc"
	picture = GFX_evt_news_room
	location = ROOT
	
	
	trigger = {
		has_planet_flag = mem_food_constructor_step1
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	immediate = {
		remove_planet_flag = mem_food_constructor_step1
		set_planet_flag = mem_food_constructor_step2
	}
	
	option = {
		name = mem_food_constructor.2a
		
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_fanatic_materialist
					has_ethic = ethic_materialist
					has_ethic = ethic_fanatic_xenophobe
					has_ethic = ethic_xenophobe				
				}
			}
		}
		
		remove_modifier = "mem_food_constructor_modifier_1"
		
		
		add_modifier = {
			modifier = mem_food_constructor_modifier_2
			days = -1
		}
		
		begin_event_chain = {
			event_chain = "mem_food_constructor_chain"
		}
	}
	

	option = {
		name = mem_food_constructor.2b
		
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_materialist
					has_ethic = ethic_materialist
				}
			}
		}
		
		remove_modifier = "mem_food_constructor_modifier_1"
		
		
		add_modifier = {
			modifier = mem_food_constructor_modifier_2
			days = -1
		}
		
		begin_event_chain = {
			event_chain = "mem_food_constructor_chain"
		}
	}
	
	option = {
		name = mem_food_constructor.2c
		
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_xenophobe
					has_ethic = ethic_xenophobe				
				}
			}
		}
		
		remove_modifier = "mem_food_constructor_modifier_1"
		
		add_modifier = {
			modifier = mem_food_constructor_modifier_2
			days = -1
		}
		
		begin_event_chain = {
			event_chain = "mem_food_constructor_chain"
		}
	}

}

#Step 3: Things are bad
planet_event = {
	id = mem_food_constructor.3
	title = "mem_food_constructor.3.name"
	desc = "mem_food_constructor.3.desc"
	picture = GFX_evt_news_room
	location = ROOT
	
	
	trigger = {
		has_planet_flag = mem_food_constructor_step2
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	immediate = {
		remove_planet_flag = mem_food_constructor_step2
		set_planet_flag = mem_food_constructor_step3
	}
	
		option = {
		name = mem_food_constructor.3a
		
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_fanatic_materialist
					has_ethic = ethic_materialist
					has_ethic = ethic_fanatic_xenophobe
					has_ethic = ethic_xenophobe				
					has_ethic = ethic_fanatic_militarist
					has_ethic = ethic_militarist
					has_ethic = ethic_fanatic_xenophile
					has_ethic = ethic_xenophile
				}
			}
		}
		
		remove_modifier = "mem_food_constructor_modifier_2"
		
		add_modifier = {
			modifier = mem_food_constructor_modifier_3
			days = -1
		}
	}
	

	option = {
		name = mem_food_constructor.3b
		
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_materialist
					has_ethic = ethic_materialist
				}
			}
		}
		
		remove_modifier = "mem_food_constructor_modifier_2"
		
		add_modifier = {
			modifier = mem_food_constructor_modifier_3
			days = -1
		}
	}
	
	option = {
		name = mem_food_constructor.3c
		
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_xenophobe
					has_ethic = ethic_xenophobe				
				}
			}
		}
		
		remove_modifier = "mem_food_constructor_modifier_2"
		
		add_modifier = {
			modifier = mem_food_constructor_modifier_3
			days = -1
		}
	}

	option = {
		name = mem_food_constructor.3d
		
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_militarist
					has_ethic = ethic_militarist
				}
			}
		}
		
		remove_modifier = "mem_food_constructor_modifier_2"
		
		
		add_modifier = {
			modifier = mem_food_constructor_modifier_3
			days = -1
		}
	}
	
	option = {
		name = mem_food_constructor.3e
		
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_fanatic_xenophile
					has_ethic = ethic_xenophile				
				}
			}
		}
		
		remove_modifier = "mem_food_constructor_modifier_2"
		
		
		add_modifier = {
			modifier = mem_food_constructor_modifier_3
			days = -1
		}
	}

}

#Step 4: Things are really bad
planet_event = {
	id = mem_food_constructor.4
	title = "mem_food_constructor.4.name"
	desc = "mem_food_constructor.4.desc"
	picture = GFX_evt_news_room
	location = ROOT
	
	
	trigger = {
		has_planet_flag = mem_food_constructor_step3
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	immediate = {
		remove_planet_flag = mem_food_constructor_step3
		set_planet_flag = mem_food_constructor_step4
	}
	option = {
		name = mem_food_constructor.4a
		
		
		remove_modifier = "mem_food_constructor_modifier_3"	
		
		add_modifier = {
			modifier = mem_food_constructor_modifier_4
			days = -1
		}
	}

}

#######################################
#     SEARCH FOR THE KEY              #
#######################################

#Signature detected
planet_event = {

	id = mem_food_constructor.5
	title = mem_food_constructor.5.name
	desc = mem_food_constructor.5.desc
	picture = GFX_evt_physics_research
	location = ROOT

	trigger = {
		OR = {
			has_planet_flag = mem_food_constructor_step2
			has_planet_flag = mem_food_constructor_step3
			has_planet_flag = mem_food_constructor_step4
		}
		NOT = {
			owner = {
				has_country_flag = mem_food_constructor_search
			}
		}
	}
	
	mean_time_to_happen = {
		months = 1
	}
	
	immediate = {
		owner = {
			set_country_flag = mem_food_constructor_search
		}
		save_event_target_as = origin
	}
	
	option = {
		name = mem_food_constructor.5a
		trigger = {
			owner = {
				NOR = {
					has_ethic = ethic_fanatic_spiritualist
					has_ethic = ethic_spiritualist
				}
			}
		}
		
		hidden_effect = {
			#What if someone else had created the system already?
			IF = {
				limit = {
					NOT = {
						any_system = {
							has_star_flag = mem_food_constructor_crashsite
						}
					}
				}
				
				random_system = {
					limit = {
						any_planet = {
							is_planet_class = pc_barren
							is_planet_class = pc_barren_cold
							is_planet_class = pc_toxic
						}
						distance = {
						source = event_target:origin
						min = 1
						max = 4
						}
						NOT = {
							has_star_flag = hostile_system
						}
					}
					set_star_flag = mem_food_constructor_crashsite
				}
				
				IF = {
					limit = {
						NOT = {
							any_system = {
								has_star_flag = mem_food_constructor_crashsite
							}
						}
					}
					
					random_system = {
						limit = {
							has_star_flag = mem_food_constructor_home
						}
						spawn_system = {
							min_distance = 1
							max_distance = 4
							initializer = "mem_food_constructor_crash_system"
						}
					}
				}
			}
			random_system = {
				limit = {
					has_star_flag = mem_food_constructor_crashsite
				}
				save_event_target_as = crashsite
			}
		}
		
		create_point_of_interest = {
			id = mem_food_constructor_poi1
			name = mem_food_constructor_poi1
			desc = mem_food_constructor_poi1_desc
			event_chain = mem_food_constructor_chain
			location = event_target:crashsite
		}
	}

}

#We arrived in the system where crash site is
ship_event = {
	
	id = mem_food_constructor.6
	title = mem_food_constructor.6.name
	desc = mem_food_constructor.6.desc
	picture = GFX_evt_ship_in_orbit
	location = ROOT
	
	is_triggered_only = yes
		
	trigger = {
		owner = {
			has_country_flag = mem_food_constructor_search
			NOT = {
				has_country_flag = mem_food_constructor_foundcrash
			}
		}
	}
	
	option = {
		name = mem_food_constructor.6a
		
		closest_system = {
			random_system_planet = {
				limit = {
					is_planet_class = pc_barren
					is_planet_class = pc_barren_cold
					is_planet_class = pc_toxic
				}
				enable_special_project = {
					name = "MEM_FOOD_CONSTRUCTOR_CRASHSITE"
					location = this
					owner = root
				}
			}
		}
		owner = { 
			remove_point_of_interest = mem_food_constructor_poi1
		}
	}
}

#Special project complete

ship_event = {

	id = mem_food_constructor.7
	title = mem_food_constructor.7.name
	desc = mem_food_constructor.7.desc
	picture = GFX_evt_mem_wreckage_shelter
	location = ROOT
	
	is_triggered_only = yes
	
	option = {
		name = mem_food_constructor.7a
		
		IF = {
			trigger = {
				any_system = {
					NOT = {
						has_star_flag = mem_food_constructor_recluse_system
					}
				}
			}
			closest_system = {
				spawn_system = {
					min_distance = 1
					max_distance = 10
					initializer = "mem_food_constructor_recluse_system"
				}
			}
		}
		
		random_system = {
			limit = {
				has_star_flag = mem_food_constructor_recluse_system
			}
			random_planet = {
				limit = {
					has_planet_flag = mem_food_constructor_recluse
				}
				enable_special_project = {
					name = "MEM_FOOD_CONSTRUCTOR_RECLUSE"
					location = this
					owner = root
				}
			}
		}
	}
}