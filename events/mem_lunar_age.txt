#############
#The Lunar Age
#By ViolentBeetle
#############

namespace = mem_lunar_age

@MTTHIND = 12

@diplomatictimer = 30

#DEBUG EVENT
country_event = {
	id = mem_lunar_age.9999
	
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		capital_scope = {
			spawn_system = {
				min_distance = 20
				max_distance = 50
				initializer = "mem_lunar_age_system"
			}
		}
	}
}

#On action: homeworld surveyed
ship_event = {
	id = mem_lunar_age.1
	title = mem_lunar_age.1.name
	desc = mem_lunar_age.1.desc
	
	picture = GFX_evt_metropolis
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			exists = owner
			owner = {
				has_country_flag = mem_lunar_age
				is_country_type = primitive
			}
		}
		owner = {
			NOT = { has_country_flag = mem_lunar_age_surveyed }
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = mem_lunar_age_surveyed
		}
	}
	
	option = {
		name = INTERESTING
		owner = {
			hidden_effect = { country_event = { id = story.6 days = 30 } }
		}
	}
}

#On action: surveyed colony
ship_event = {
	id = mem_lunar_age.2
	title = mem_lunar_age.2.name
	desc = mem_lunar_age.2.desc
	
	picture = GFX_evt_metropolis
	location = FROM
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			exists = owner
			owner = {
				has_country_flag = mem_lunar_age_colony
				is_country_type = primitive
			}
		}
		owner = {
			NOT = { has_country_flag = mem_lunar_age_surveyed }
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = mem_lunar_age_surveyed
		}
	}
	
	option = {
		name = INTERESTING
		owner = {
			hidden_effect = { country_event = { id = story.6 days = 30 } }
		}
	}
}

#############################
#Road to independence
#############################

#troubles brewing
country_event = {
	id = mem_lunar_age.300
	
	hide_window = yes
	
	mean_time_to_happen = {
		months = @MTTHIND
	}
	
	trigger = {
		is_country_type = primitive
		has_country_flag = mem_lunar_age_colony
		NOT = {
			has_country_flag = mem_lunar_age_path_chosen
		}
		NOT = { has_global_flag = mem_lunar_age_grace_period }
		any_country = {
			is_country_type = primitive
			has_country_flag = mem_lunar_age
		}
	}
	
	immediate = {
		shift_ethic = ethic_militarist
		set_country_flag = mem_lunar_age_path_chosen
		set_country_flag = mem_lunar_age_independence_path
		save_event_target_as = moon_faction
		
		capital_scope = {
			observation_outpost_owner = {
				country_event = { id = mem_lunar_age.301 }
			}
		}
		
		random_country = {
			limit = { has_country_flag = mem_lunar_age }
			country_event = { id = mem_lunar_age.302 days = @diplomatictimer }
		}
	}
}

#Notification
country_event = {
	id = mem_lunar_age.301
	title = mem_lunar_age.301.name
	desc = mem_lunar_age.301.desc
	
	picture = GFX_evt_metropolis
	location = FROM
	
	is_triggered_only = yes
	
	option = {
		name = INTERESTING
	}
}

#Homeworld considers its options
country_event = {
	id = mem_lunar_age.302
	
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = primitive
		exists = event_target:moon_faction
		event_target:moon_faction = {
			is_country_type = primitive
		}
	}
	
	immediate = {
		save_event_target_as = home_faction
		random_list = {
			1 = { #Pacifist response
				modifier = {
					factor = 2
					has_ethic = ethic_pacifist
				}
				modifier = {
					factor = 10
					has_ethic = ethic_fanatic_pacifist
				}
				modifier = {
					factor = 2
					has_ethic = ethic_pacifist
				}
				modifier = {
					factor = 10
					has_ethic = ethic_fanatic_pacifist
				}
				capital_scope = {
					observation_outpost_owner = {
						country_event = { id = mem_lunar_age.303 }
					}
				}
				event_target:moon_faction = {
					country_event = { id = mem_lunar_age.304 days = @diplomatictimer }
				}
			}
			
			1000 = { #Militarist response
				modifier = {
					factor = 2
					has_ethic = ethic_militarist
				}
				modifier = {
					factor = 10
					has_ethic = ethic_fanatic_militarist
				}
				modifier = {
					factor = 2
					has_ethic = ethic_authoritarian
				}
				modifier = {
					factor = 10
					has_ethic = ethic_fanatic_authoritarian
				}
				
				capital_scope = {
					observation_outpost_owner = {
						country_event = { id = mem_lunar_age.306 }
					}
				}
				event_target:moon_faction = {
					country_event = { id = mem_lunar_age.307 days = @diplomatictimer }
				}
			}
		}
	}
}

#Observer is notified that they accepted independence
country_event = {
	id = mem_lunar_age.303
	title = mem_lunar_age.303.name
	desc = mem_lunar_age.303.desc
	
	picture = GFX_evt_metropolis
	location = FROM
	
	is_triggered_only = yes
	
	option = {
		name = INTERESTING
	}
}

#Observer is notified that they didn't accepted independence
country_event = {
	id = mem_lunar_age.306
	title = mem_lunar_age.306.name
	desc = mem_lunar_age.306.desc
	
	picture = GFX_evt_metropolis
	location = FROM
	
	is_triggered_only = yes
	
	option = {
		name = INTERESTING
	}
}

#Splitting colonies peacefully
country_event = {
	id = mem_lunar_age.304
	
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = primitive
		exists = event_target:home_faction
		event_target:home_faction = {
			is_country_type = primitive
		}
	}
	
	immediate = {
		change_government = {
			#authority = random
			civics = {
				civic = civic_mem_declaration_of_independence
				civic = civic_mem_land_of_opportunity
			}
		}
		remove_country_flag = mem_lunar_age_colony
		set_country_flag = early_space_age
		set_primitive_age = early_space_age
		set_country_flag = mem_lunar_age_path_complete
		set_name = random
		
		
		event_target:home_faction = {
			change_government = {
				#authority = random
				civics = {
					civic = civic_increasing_urbanization
					civic = civic_atmospheric_pollution
				}
			}
		
			remove_country_flag = mem_lunar_age_colony
			set_country_flag = early_space_age
			set_primitive_age = early_space_age
		}
		capital_scope = {
			observation_outpost_owner = {
				country_event = { id = mem_lunar_age.305 }
			}
		}
	}
}

#Observer is notified that independence is finished
country_event = {
	id = mem_lunar_age.305
	title = mem_lunar_age.305.name
	desc = mem_lunar_age.305.desc
	
	picture = GFX_evt_metropolis
	location = FROM
	
	is_triggered_only = yes
	
	option = {
		name = INTERESTING
	}
}

#Moon started mobilizing
country_event = {
	id = mem_lunar_age.307
	
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = primitive
		exists = event_target:home_faction
		event_target:home_faction = {
			is_country_type = primitive
		}
	}
	
	immediate = {
		shift_ethic = ethic_militarist
		event_target:home_faction = {
			country_event  = { id = mem_lunar_age.309 days = @diplomatictimer }
		}
		change_government = {
			#authority = random
			civics = {
				civic = civic_mem_declaration_of_independence
				civic = civic_mem_land_of_opportunity
			}
		}
		capital_scope = {
			observation_outpost_owner = {
				country_event = { id = mem_lunar_age.308 }
			}
			# create_fleet = { name = NAME_mem_colonial_defense_fleet }
			# last_created_fleet = {
				# set_fleet_flag = mem_lunar_age_colony
				# set_owner = root
				# while = {
					# count = 3
					# create_ship = {
						# name = random
						# design = NAME_mem_war_shuttle
					# }
				# }
				# set_location = {
					# target = prev
				# }
			# }
		}
	}
}

#Observer is notified that moon started to mobilize
country_event = {
	id = mem_lunar_age.308
	title = mem_lunar_age.308.name
	desc = mem_lunar_age.308.desc
	
	picture = GFX_evt_metropolis
	location = FROM
	
	is_triggered_only = yes
	
	option = {
		name = WORRYING
	}
}

#Now the homeworld is mobilizing
country_event = {
	id = mem_lunar_age.309
	
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = primitive
		exists = event_target:moon_faction
		event_target:home_faction = {
			is_country_type = primitive
		}
	}
	
	immediate = {
		random_list = {
			33 = { shift_ethic = ethic_militarist }
			66 = {  }
		}
		capital_scope = {
			IF = {
				limit = { has_observation_outpost = yes }
				observation_outpost_owner = {
					country_event = { id = mem_lunar_age.310 }
				}
				else = {
					owner = {
						country_event = { id = mem_lunar_age.311 }
					}
				}
			}
			# create_fleet = { name = NAME_mem_homeworld_defense_fleet }
			# last_created_fleet = {
				# set_fleet_flag = mem_lunar_age_homeworld
				# set_owner = root
				# while = {
					# count = 3
					# create_ship = {
						# name = random
						# design = NAME_mem_war_shuttle
					# }
				# }
				# set_location = {
					# target = prev
				# }
			# }
		}
	}
}

#Observer is notified that homeworld started to mobilize
country_event = {
	id = mem_lunar_age.310
	title = mem_lunar_age.310.name
	desc = mem_lunar_age.310.desc
	
	picture = GFX_evt_metropolis
	location = FROM
	
	is_triggered_only = yes
	
	option = {
		name = mem_lunar_age.310.a
		custom_tooltip = mem_lunar_age.310.a.tooltip
		hidden_effect = {
			event_target:home_faction = {
				country_event = { id = mem_lunar_age.311 days = @diplomatictimer }
			}
		}
		
	}
	
	option = {
		name = mem_lunar_age.310.b
		
		hidden_effect = {
			random_list = {
				1 = {
					country_event = { id = mem_lunar_age.313 } # Open negotiations
					modifier = {
						factor = 2
						has_ethic = ethic_xenophile
					}
					modifier = {
						factor = 4
						has_ethic = ethic_fanatic_xenophile
					}
				}
				1 = {
					country_event = { id = mem_lunar_age.312 } #They don't want to
					modifier = {
						factor = 2
						has_ethic = ethic_xenophobe
					}
					modifier = {
						factor = 4
						has_ethic = ethic_fanatic_xenophobe
					}
				}
			}
		}
	}
}

#Homeworld event: going to war
country_event = {
	id = mem_lunar_age.311
	
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		is_country_type = primitive
		exists = event_target:moon_faction
		event_target:moon_faction = {
			is_country_type = primitive
		}
	}
	
	immediate = {
		#Chain outcome will be placed here
	}
}

#Diplomatic event: they don't want us to have anything to do with anything

country_event = {
	id = mem_lunar_age.312
	title = mem_lunar_age.312.name
	desc = mem_lunar_age.312.desc
	
	is_triggered_only = yes
	
	location = event_target:home_faction
	
	diplomatic = yes
	
	picture_event_data = {
		portrait = event_target:home_faction
		room = mem_server_room
	}
	
	trigger = {
		exists = event_target:home_faction
		exists = event_target:moon_faction
		event_target:moon_faction = {
			is_country_type = primitive
		}
		event_target:home_faction = {
			is_country_type = primitive
		}
	}
	
	option = {
		name = mem_lunar_age.312.a
		custom_tooltip = mem_lunar_age.312.a.tooltip
		
		hidden_effect = {
			event_target:home_faction = {
				country_event = { id = mem_lunar_age.311 days = @diplomatictimer}
			}
		}
		
		trigger = {
			NOR = {
				has_ethic = ethic_fanatic_pacifist
				has_ethic = ethic_pacifist
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_xenophile
			}
		}
	}
	
	option = {
		name = mem_lunar_age.312.a.phile
		custom_tooltip = mem_lunar_age.312.a.tooltip
		
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_pacifist
				has_ethic = ethic_pacifist
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_xenophile
			}
		}
	}
	
	option = {
		name = mem_lunar_age.312.b
		custom_tooltip = mem_lunar_age.312.b.tooltip
		
		trigger = {
			NOR = {
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_fanatic_pacifist
			}
			OR = {
				has_ethic = ethic_militarist
				has_ethic = ethic_fanatic_militarist
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
			}
		}
		
		event_target:home_faction = {
			random_list = {
				66 = { shift_ethic = ethic_xenophobe }
				33 = {  }
			}
		}
		
		event_target:moon_faction = {
			random_list = {
				66 = { shift_ethic = ethic_xenophobe }
				33 = {  }
			}
		}
		
		hidden_effect = {
			country_event = {
				id = mem_lunar_age.313
			}
			set_country_flag = mem_went_agressively
		}
	}
}