# Vestigial Wormhole
# By ViolentBeetle

namespace = mem_vestigial_wormhole

# Setting up vestigial wormhole on galaxy generation
event = {
    id = mem_vestigial_wormhole.1
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        random_list = {
            0 = { } # TODO: Change odds
            35 = {
                random_system = {
                    limit = {
                        NOR = {
                            any_ship_in_system = {
                                always = yes
                            }
                            has_star_flag = hostile_system
                        }
                    }
                    set_name = "LOOK AT ME I'M WORMHOLE"
                    set_star_flag = mem_vestigial_wormhole_system
                    create_ambient_object = {
                        type = mem_vestigial_wormhole_object
                        location = this
                    }
                    last_created_ambient_object = {
                        save_global_event_target_as = mem_vestigial_wormhole_ambient_object
                    }
                }
            }
        }
    }
}

# Ship enters system and event pops up
ship_event = {
    id = mem_vestigial_wormhole.2
    title = mem_vestigial_wormhole.2.name
    desc = mem_vestigial_wormhole.2.desc

    is_triggered_only = yes

    picture = GFX_evt_wormhole
    location = FROM
    show_sound = event_default

    trigger = {
        owner = {
            is_ai = no
            NOT = { has_country_flag = mem_vestigial_wormhole_found_system }
        }
        FROM = {
            has_star_flag = mem_vestigial_wormhole_system
        }
        NOT = { has_global_flag = mem_vestigial_wormhole_ship_emerged }
    }

    immediate = {
        owner = { set_country_flag = mem_vestigial_wormhole_found_system }
    }

    option = {
        name = INTERESTING
    }
}

# Country event for the controller
country_event = {
    id = mem_vestigial_wormhole.3
    title = mem_vestigial_wormhole.3.name
    desc = mem_vestigial_wormhole.3.desc

    picture = GFX_evt_wormhole
    location = event_target:ship_object
    show_sound = event_default

    mean_time_to_happen = {
        years = 50
    }

    trigger = {
        NOT = { has_global_flag = mem_vestigial_wormhole_ship_emerged }
        any_system_within_border = {
            has_star_flag = mem_vestigial_wormhole_system
        }
        exists = event_target:mem_vestigial_wormhole_ambient_object
    }

    immediate = {
        set_global_flag = mem_vestigial_wormhole_ship_emerged
        random_system_within_border = {
            limit = { has_star_flag = mem_vestigial_wormhole_system }
            save_event_target_as = the_system
        }
        create_ambient_object = {
            type = mem_vestigial_wormhole_ship_object
            location = event_target:mem_vestigial_wormhole_ambient_object
        }
        destroy_ambient_object = event_target:mem_vestigial_wormhole_ambient_object
        last_created_ambient_object = {
            save_event_target_as = ship_object
        }
    }

    option = {
        name = mem_vestigial_wormhole.3.a

        enable_special_project = {
            name = MEM_VESTIGIAL_WORMHOLE_PROJECT
            location = event_target:ship_object
            owner = root
        }

        ai_chance = {
            factor = 100
        }
    }

    option = {
        name = mem_vestigial_wormhole.3.b
        add_influence = 100

        ai_chance = {
            factor = 0
        }
    }
}

# Ship event: Found scientist
ship_event = {
    id = mem_vestigial_wormhole.4
    title = mem_vestigial_wormhole.4.name
    desc = mem_vestigial_wormhole.4.desc

    is_triggered_only = yes

    picture = GFX_evt_ship_in_orbit
    location = event_target:ship_object
    show_sound = event_default

    immediate = {
        IF = {
            limit = {
                NOR = {
                    any_system = { has_star_flag = sol }
                    any_country = {
                        any_owned_pop_species = { species_portrait = human }
                    }
                }
            }
            create_species = {
                name = Human
                plural = Humans
                adjective = Human
                class = "HUM"
                portrait = "human"
                traits = {
                    trait = "trait_adaptive"
                    trait = "trait_nomadic"	
                    trait = "trait_wasteful"
                }
            }
            owner = {
                create_saved_leader = {
                    creator = this
                    key = mem_vestigial_wormhole_leader
                    event_leader = no
                    type = scientist
                    species = last_created_species
                    name = "Elias Davenport"
                    skill = 4
                    traits = {
                        trait = mem_vestigial_wormhole_wanderer_trait
                    }
                    gender = male
                    effect = {
                        save_event_target_as = the_guy
                    }
                }
            }
        }
        ELSE = {
            create_species = {
                name = Dommel
                plural = Dommels
                adjective = Dommel
                class = "REP"
                portrait = random
                traits = {
                    trait = "trait_adaptive"
                    trait = "trait_nomadic"	
                    trait = "trait_wasteful"
                }
            }
            owner = {
                create_saved_leader = {
                    creator = this
                    key = mem_vestigial_wormhole_leader
                    event_leader = no
                    type = scientist
                    species = last_created_species
                    name = "Tinsar Hammelish"
                    skill = 4
                    traits = {
                        trait = mem_vestigial_wormhole_wanderer_trait
                    }
                    gender = male
                    effect = {
                        save_event_target_as = the_guy
                    }
                }
            }
        }
    }

    option = {
        name = mem_vestigial_wormhole.4.a

        owner = {
            activate_saved_leader = {
                add_to_owned = yes
                key = mem_vestigial_wormhole_leader
            }
        }
    }

    option = {
        name = mem_vestigial_wormhole.4.b

        owner = {
            add_influence = 200
        }
    }

    option = {
        name = mem_vestigial_wormhole.4.c

        trigger = {
            owner = {
                OR = {
                    has_ethic = ethic_xenophobe
                    has_ethic = ethic_fanatic_xenophobe
                }
            }
        }

        owner = {
            add_monthly_resource_mult = {
				resource = unity
				value = @tier2unityreward
				min = @tier2unitymin
				max = @tier2unitymax
			}
        }
    }

    option = {
        name = mem_vestigial_wormhole.4.d

        trigger = {
            owner = {
                OR = {
                    has_ethic = ethic_gestalt_consciousness
                    has_ethic = ethic_xenophobe
                    has_ethic = ethic_fanatic_xenophobe
                    has_ethic = ethic_materialist
                    has_ethic = ethic_fanatic_materialist
                }
            }
        }

        owner = {
            add_monthly_resource_mult = {
				resource = physics_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
            add_monthly_resource_mult = {
				resource = society_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
        }
    }

    option = {
        name = mem_vestigial_wormhole.4.inwards

        exclusive_trigger = {
            owner = {
                has_valid_civic = civic_inwards_perfection
            }
        }

        owner = {
            add_monthly_resource_mult = {
				resource = unity
				value = @tier3unityreward
				min = @tier3unitymin
				max = @tier3unitymax
			}
        }
    }

    option = {
        name = mem_vestigial_wormhole.4.servitor

        exclusive_trigger = {
            owner = {
                has_valid_civic = civic_machine_servitor
            }
        }

        owner = {
            add_monthly_resource_mult = {
				resource = unity
				value = @tier3unityreward
				min = @tier3unitymin
				max = @tier3unitymax
			}
        }
    }

    option = {
        name = mem_vestigial_wormhole.4.purifier

        exclusive_trigger = {
            owner = {
                has_valid_civic = civic_fanatic_purifiers
            }
        }

        owner = {
            add_monthly_resource_mult = {
				resource = unity
				value = @tier3unityreward
				min = @tier3unitymin
				max = @tier3unitymax
			}
        }
    }

    option = {
        name = mem_vestigial_wormhole.4.terminator

        exclusive_trigger = {
            owner = {
                has_valid_civic = civic_machine_terminator
            }
        }

        owner = {
            add_monthly_resource_mult = {
				resource = unity
				value = @tier3unityreward
				min = @tier3unitymin
				max = @tier3unitymax
			}
        }
    }

    option = {
        name = mem_vestigial_wormhole.4.swarm

        exclusive_trigger = {
            owner = {
                has_valid_civic = civic_hive_devouring_swarm
            }
        }

        leader = {
            add_experience = 500
        }
    }
}