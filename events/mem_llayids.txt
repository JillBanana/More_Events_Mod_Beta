
######################################
### Writing and Coding by Caligula ###
######################################

namespace = mem_llayids


#Initial discovery
ship_event = {
	id = mem_llayids.1
	title = mem_llayids.1.name
	desc = {
		trigger = { owner = { not = { has_ethic = ethic_gestalt_consciousness } } }
		text = mem_llayids.1.desc
	}
	desc = {
		trigger = { owner = { has_authority = auth_hive_mind } }
		text = mem_llayids.1.desc.hive
	}
	desc = {
		trigger = { owner = { has_authority = auth_machine_intelligence } }
		text = mem_llayids.1.desc.machine
	}
	
	is_triggered_only = yes
	
	picture = GFX_evt_gas_giant
	location = FROM
	
	immediate = {
		from = {
			orbital_deposit_tile = { clear_deposits = yes }

			set_planet_flag = mem_llayid_planet
			solar_system = {
				set_star_flag = mem_llayid_system
			}

			add_modifier = {
				modifier = mem_llayid_planet
				days = -1
			}
		}
	}

	option = {
		name = mem_llayids.1.A

		from = {
			orbital_deposit_tile = {
				set_deposit = d_vast_society_deposit
			}
		}

		hidden_effect = {
			owner = {
				set_country_flag = mem_llayid_investigate
			}
		}

		trigger = {
			NOT = {
				owner = { has_valid_civic = civic_fanatic_purifiers }
			}
		}
	}
	
	option = {
		name = mem_llayids.1.B

		from = {
			orbital_deposit_tile = {
				set_deposit = d_vast_society_deposit
			}
		}

		hidden_effect = {
			owner = {
				set_country_flag = mem_llayid_investigate
			}
		}

		trigger = {
			NOT = {
				owner = { has_valid_civic = civic_fanatic_purifiers }
			}
		}
	}
	
	option = {
		name = mem_llayids.1.C

		from = {
			orbital_deposit_tile = {
				set_deposit = d_vast_society_deposit
			}
		}

		hidden_effect = {
			owner = {
				set_country_flag = mem_llayid_investigate
				set_country_flag = mem_llayid_investigate_weapon
			}
		}

		trigger = {
			NOT = {
				owner = { has_valid_civic = civic_fanatic_purifiers }
			}
		}
	}

	option = {
		name = mem_llayids.1.purifier

		from = {
			orbital_deposit_tile = {
				set_deposit = d_vast_society_deposit
			}
		}

		hidden_effect = {
			owner = {
				set_country_flag = mem_llayid_investigate_weapon
			}
		}

		trigger = {
			owner = {
				has_valid_civic = civic_fanatic_purifiers
			}
		}
	}
	option = {
		name = mem_llayids.1.swarm

		from = {
			orbital_deposit_tile = {
				set_deposit = d_vast_society_deposit
			}
		}

		hidden_effect = {
			owner = {
				set_country_flag = mem_llayid_investigate_weapon
			}
		}

		trigger = {
			owner = {
				has_valid_civic = civic_hive_devouring_swarm
			}
		}
	}
	option = {
		name = mem_llayids.1.terminator

		from = {
			orbital_deposit_tile = {
				set_deposit = d_vast_society_deposit
			}
		}

		hidden_effect = {
			owner = {
				set_country_flag = mem_llayid_investigate_weapon
			}
		}

		trigger = {
			owner = {
				has_valid_civic = civic_machine_terminator
			}
		}
	}
}


# This = construction ship
# From = planet it is built on
# Fires when construction is complete,
# immediately before station is created
country_event = {
	id = mem_llayids.2
	title = mem_llayids.2.title
	desc = {
		text = mem_llayids.2.desc.weapon
		trigger = {
			has_country_flag = mem_llayid_investigate_weapon
		}
	}
	desc = {
		text = mem_llayids.2.desc
		trigger = {
			has_country_flag = mem_llayid_investigate
		}
	}
	picture = GFX_evt_space_debris
	location = FROM

	is_triggered_only = yes

	trigger = {
		from = {
			has_planet_flag = mem_llayid_planet
		}
		owner = {
			OR = {
				has_country_flag = mem_llayid_investigate
				has_country_flag = mem_llayid_investigate_weapon
			}
		}
	}

	immediate = {
		from = {
			save_event_target_as = mem_llayid_planet
		}
	}

	option = {
		name = OK
		
		hidden_effect = {
			if = {
				limit = {
					has_country_flag = mem_llayid_investigate
					has_country_flag = mem_llayid_investigate_weapon
				}
				remove_country_flag = mem_llayid_investigate_weapon
			}
			if = {
				limit = {
					has_country_flag = mem_llayid_investigate_weapon
					NOT = {
						has_country_flag = mem_llayid_investigate
					}
				}
				country_event = { id = mem_llayids.3 days = 720 }
			}
			else = {
				country_event = { id = mem_llayids.5 days = 360 }
			}
		}
	}
}

#Purifier version
country_event = {
	id = mem_llayids.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_system_within_border = {
			has_star_flag = mem_llayid_system
			any_planet = {
				has_planet_flag = mem_llayid_planet
			}
		}
	}

	immediate = {
		if = {
			limit = {
				any_system_within_border = {
					has_star_flag = mem_llayid_system
					any_planet = {
						has_planet_flag = mem_llayid_planet
						has_research_station = yes
					}
				}
			}
			country_event = { id = mem_llayids.4 }
		}
		else = {
			event_target:mem_llayid_planet = {
				save_event_target_as = mem_llayid_planet
			}
			country_event = { id = mem_llayids.3 days = 720 }
		}
	}
}


country_event = {
	id = mem_llayids.4
	title = mem_llayids.4.title
	desc = {
		trigger = { not = { has_ethic = ethic_gestalt_consciousness } }
		text = mem_llayids.4.desc
	}
	desc = {
		trigger = { has_authority = auth_hive_mind }
		text = mem_llayids.4.desc.hive
	}
	desc = {
		trigger = { has_authority = auth_machine_intelligence }
		text = mem_llayids.4.desc.machine
	}
	picture = GFX_evt_space_debris
	location = event_target:mem_llayid_planet

	is_triggered_only = yes

	immediate = {
		remove_country_flag = mem_llayid_investigate_weapon
	}

	option = {
		name = mem_llayids.4.A
		
		add_monthly_resource_mult = {
			resource = society_research
			value = 4
			min = 100
		}
	}
}


#Normal version
country_event = {
	id = mem_llayids.5
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_system_within_border = {
			has_star_flag = mem_llayid_system
			any_planet = {
				has_planet_flag = mem_llayid_planet
			}
		}
	}

	immediate = {
		if = {
			limit = {
				any_system_within_border = {
					has_star_flag = mem_llayid_system
					any_planet = {
						has_planet_flag = mem_llayid_planet
						has_research_station = yes
					}
				}
			}
			country_event = { id = mem_llayids.6 }
		}
		else = {
			event_target:mem_llayid_planet = {
				save_event_target_as = mem_llayid_planet
			}
			country_event = { id = mem_llayids.5 days = 720 }
		}
	}
}




country_event = {
	id = mem_llayids.6
	title = mem_llayids.6.name
	desc = {
		trigger = { not = { has_ethic = ethic_gestalt_consciousness } }
		text = mem_llayids.6.desc
	}
	desc = {
		trigger = { has_authority = auth_hive_mind }
		text = mem_llayids.6.desc.hive
	}
	desc = {
		trigger = { has_authority = auth_machine_intelligence }
		text = mem_llayids.6.desc.machine
	}
	picture = GFX_evt_space_debris
	location = event_target:mem_llayid_planet

	is_triggered_only = yes

	immediate = {
	}

	option = {
		name = INTERESTING

		add_monthly_resource_mult = {
			resource = society_research
			value = 3
			min = 100
		}

		hidden_effect = {
			country_event = { id = mem_llayids.7 days = 480 random = 360 }
		}
	}
}
