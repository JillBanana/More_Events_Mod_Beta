# Convict
# Code and Text by ViolentBeetle
# Idea by Solarius Scorch

namespace = mem_convict

# Anomaly solution
ship_event = {
    id = mem_convict.1
    title = mem_convict.1.name
    desc = mem_convict.1.desc

    is_triggered_only = yes

    location = FROM
    picture = GFX_evt_mem_crashed_ship
    show_sound = event_default

    immediate = {
        FROM = { save_event_target_as = the_planet }
    }

    option = {
        name = mem_convict.1.a

        owner.capital_scope = {
            enable_special_project = {
                name = MEM_CONVICT_STUDY_POD
                location = THIS
                owner = root.owner
            }
        }
    }
    option = {
        name = mem_convict.1.b
        owner = {
            add_resource = {
                influence = 25
            }
        }
    }
    option = {
        name = mem_convict.1.c
        exclusive_trigger = {
            owner = {
                OR = {
                    has_valid_civic = civic_fanatic_purifiers
                    has_valid_civic = civic_machine_terminator
                }
            }
        }
        owner = {
            add_monthly_resource_mult = {
                resource = unity
                value = @tier2unityreward
                min = @tier2unitymin
                max = @tier2unitymax
            }
        }
    }
    option = {
        name = mem_convict.1.d
        exclusive_trigger = {
            owner = {
                has_valid_civic = civic_hive_devouring_swarm
            }
        }
        owner = {
            add_resource = {
                food = 1
            }
        }
        leader = {
            add_experience = 100
        }
    }
}

# Project resolution
country_event = {
    id = mem_convict.2
    title = mem_convict.2.name
    desc = mem_convict.2.desc

    is_triggered_only = yes

    picture = GFX_evt_society_research
    show_sound = event_default

    immediate = {
        random_list = {
            50 = { set_country_flag = mem_convict_will_go_bad }
            50 = { set_country_flag = mem_convict_will_go_good }
        }
        random_list = {
            50 = { set_country_flag = mem_convict_portent_arrives }
            50 = {  }
        }
    }

    option = {
        name = mem_convict.2.a

        hidden_effect = {
            country_event = {
                id = mem_convict.3
                days  = 15
            }
        }
    }

    option = {
        name = mem_convict.2.b

        add_monthly_resource_mult = {
            resource = unity
            value = @tier2unityreward
            min = @tier2unitymin
            max = @tier2unitymax
        }
    }
}

# Reedan Rhyn woke up
country_event = {
    id = mem_convict.3
    title = mem_convict.3.name
    desc = mem_convict.3.desc

    is_triggered_only = yes

    picture = GFX_evt_throne_room
    show_sound = event_default

    immediate = {
        IF = {
            limit = { 
                NOT = { species_portrait = art17 } 
            }
            create_species = {
                name = "Rendan"
                adjective = "Rendan"
                plural = "Rendans"
                class = ART
                portrait = art19
                traits = {
                    trait = trait_erudite
                    trait = trait_enduring
                }
            }
        }
        ELSE = {
            create_species = {
                name = "Rendan"
                adjective = "Rendan"
                plural = "Rendans"
                class = ART
                portrait = art20
                traits = {
                    trait = trait_erudite
                    trait = trait_enduring
                }
            }
        }
        last_created_species = { save_event_target_as = rendan_species }
        create_saved_leader = {
            key = mem_convict_retheri_rhin
            name = "Retheri Rhin"
            species = last_created_species
            class = governor
            gender = male
            skill = 4
            traits = {
                # Make a new trait later
                trait = leader_trait_governor_erudite
            }

            effect = {
                set_leader_flag = mem_convict_retheri_rhin
                add_ruler_trait = leader_trait_ruler_erudite
                save_event_target_as = retheri_rhin
            }
        }
    }

    # Array of flavourful options for different ethics to accept leader.
    option = {
        name = mem_convict.3.a
        custom_tooltip = mem_convict.3.a.tooltip

        trigger = {

        }

        hidden_effect = {
            activate_saved_leader = {
                key = mem_convict_retheri_rhin
            }
            country_event = {
                id = mem_convict.4
                days = 36
                random = 72
            }
            country_event = {
                id = mem_convict.5
                days = 36
                random = 36
            }
        }
    }
}