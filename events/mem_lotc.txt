#Legacy of the Carcharorion
#AKA The Unponounceable Welsh event chain
#By ViolentBeetle

namespace = mem_lotc

@min_distance = 10
@max_distance = 50

@tier1researchreward = 6
@tier1researchmin = 60
@tier1researchmax = 150
@tier2researchreward = 12
@tier2researchmin = 90
@tier2researchmax = 250
@tier3researchreward = 18
@tier3researchmin = 120
@tier3researchmax = 350
@tier4researchreward = 24
@tier4researchmin = 150
@tier4researchmax = 500
@tier5researchreward = 48
@tier5researchmin = 300
@tier5researchmax = 1000

# Anomaly survey success
ship_event = {
	id = mem_lotc.1
	title = "mem_lotc.1.name"
	desc = "mem_lotc.1.desc"
	picture = "GFX_evt_dead_city"
	is_triggered_only = yes
	
	immediate = {
    	owner = {
    		set_country_flag = mem_lotc_finder
			# leads to story event "Remnants" (first contact stuff)
			country_event = { id = story.5 days = 30 }
    	}
		
		from = {
			set_planet_flag = mem_lotc_start
			save_event_target_as = start
			solar_system = {
				set_star_flag = mem_lotc_start_system
			}
		}
    }

	option = {
		name = mem_lotc.1a
		
		begin_event_chain = {
			event_chain = "mem_lotc_first_chain"
			target = root.owner
		}
		
		hidden_effect = {
		
			#FIRST PROJECT
			IF = {
				limit = {
					any_system = {
						any_planet = {is_planet_class = pc_ocean }
						distance = {
							source = event_target:start
							max_distance = @max_distance
							min_distance = @min_distance
						}
						NOT = { has_star_flag = mem_lotc_start_system }
					}
				}
				
				random_planet = {
					limit = {
						is_planet_class = pc_ocean
						distance = {
							source = event_target:start
							max_distance = @max_distance
							min_distance = @min_distance
						}
						solar_system = { 
							NOT = { has_star_flag = mem_lotc_start_system } 
						}
					}
					set_planet_flag = mem_lotc_first
				}
				
				else = {
					IF = {
						limit = {
							any_system = {
								OR = {
									any_planet = {is_planet_class = pc_continental }
									any_planet = {is_planet_class = pc_gaia }
								}
								distance = {
									source = event_target:start
									max_distance = @max_distance
									min_distance = @min_distance
								}
								NOT = { has_star_flag = mem_lotc_start_system }
							}
						}
						
						random_planet = {
							limit = {
								OR = {
									is_planet_class = pc_continental
									is_planet_class = pc_gaia 
								}
								distance = {
									source = event_target:start
									max_distance = @max_distance
									min_distance = @min_distance
								}
								solar_system = { 
									NOT = { has_star_flag = mem_lotc_start_system } 
								}
							}
							set_planet_flag = mem_lotc_first
						}
						
						else = {
							IF = {
								limit = {
									any_system = {
										any_planet = {is_planet_class = pc_tropical }
										distance = {
											source = event_target:start
											max_distance = @max_distance
											min_distance = @min_distance
										}
										NOT = { has_star_flag = mem_lotc_start_system }
									}
								}
								
								random_planet = {
									limit = {
										is_planet_class = pc_tropical
										distance = {
											source = event_target:start
											max_distance = @max_distance
											min_distance = @min_distance
										}
										solar_system = { 
											NOT = { has_star_flag = mem_lotc_start_system } 
										}
									}
									set_planet_flag = mem_lotc_first
								}
								
								else = {
									#FALLBACK INITIALIZER
									event_target:start = {
										spawn_system = {
											max_distance = @max_distance
											min_distance = @min_distance
											initializer = "mem_lotc_first_init"
										}
									}
								}
							}
						}
					}
				}
			}
			
			#SECOND PROJECT
			event_target:start = {
				spawn_system = {
					max_distance = @max_distance
					min_distance = @min_distance
					initializer = "mem_lotc_second_init"
				}
			}
			
			#THIRD PROJECT
			IF = {
				limit = {
					any_system = {
						any_planet = { is_planet_class = pc_gas_giant }
						NOT = { has_star_flag = mem_lotc_second }
						distance = {
							source = event_target:start
							max_distance = @max_distance
							min_distance = @min_distance
						}
						NOT = { has_star_flag = mem_lotc_start_system }
					}		
				}
				
				random_planet = {
					limit = {
						is_planet_class = pc_gas_giant
						distance = {
							source = event_target:start
							max_distance = @max_distance
							min_distance = @min_distance
						}
						solar_system = { 
							NOT = { has_star_flag = mem_lotc_start_system } 
						}
					}
					set_planet_flag = mem_lotc_third
				}
				
				else = {
					#FALLBACK SPAWN
					event_target:start = {
						spawn_system = {
							max_distance = @max_distance
							min_distance = @min_distance
							initializer = "mem_lotc_third_init"
						}
					}
				}
			}
			
			#FOURTH PROJECT
			IF = {
				limit = {
					any_system = {
						OR = {
							any_planet = { is_planet_class = pc_barren }
							any_planet = { is_planet_class = pc_barren_cold }
						}
						distance = {
							source = event_target:start
							max_distance = @max_distance
							min_distance = @min_distance
						}
						NOT = { has_star_flag = mem_lotc_start_system }
					}		
				}
				
				random_planet = {
					limit = {
						OR = {
							is_planet_class = pc_barren
							is_planet_class = pc_barren_cold
						}
						distance = {
							source = event_target:start
							max_distance = @max_distance
							min_distance = @min_distance
						}
						solar_system = { 
							NOT = { has_star_flag = mem_lotc_start_system } 
						}
					}
					set_planet_flag = mem_lotc_fourth
				}
				
				else = {
					#FALLBACK SPAWN
					event_target:start = {
						spawn_system = {
							max_distance = @max_distance
							min_distance = @min_distance
							initializer = "mem_lotc_fourth_init"
						}
					}
				}
			}

		
		
			#PROJECT ASSIGNMENT
			random_planet = {
				limit = {
					has_planet_flag = mem_lotc_first
				}
				enable_special_project = {
					name = "MEM_LOTC_FIRST"
					location = this
					owner = root
				}
			}
			
			random_system = {
				limit = {
					has_star_flag = mem_lotc_second
				}
				save_event_target_as = second_system
			}
			create_point_of_interest = {
				id = mem_lotc_poi.2
				name = "mem_lotc_poi.2"
				desc = "mem_lotc_poi.2.desc"
				event_chain = mem_lotc_first_chain
				location = event_target:second_system
			}
			owner = {
				set_country_flag = mem_lotc_going_for_it
			}
			
			random_planet = {
				limit = {
					has_planet_flag = mem_lotc_third
				}
				enable_special_project = {
					name = "MEM_LOTC_THIRD"
					location = this
					owner = root
				}
			}
			random_planet = {
				limit = {
					has_planet_flag = mem_lotc_fourth
				}
				enable_special_project = {
					name = "MEM_LOTC_FOURTH"
					location = this
					owner = root
				}
			}
		}
	}
}

#First set: wet planet
ship_event = {
	id = mem_lotc.2
	title = mem_lotc.2.name
	desc = mem_lotc.2.desc
	
	is_triggered_only = yes
	
	picture = GFX_evt_mem_horror_corridor
	
	option = {
		name = mem_lotc.2a
		
		owner = {
			add_event_chain_counter = {
				event_chain = "mem_lotc_first_chain" 
				counter = mem_lotc_clues 
				amount = 1 
			}
			
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}
}

#Cruiser action
#On action: Entering the second system, notified of the ship
ship_event = {
	id = mem_lotc.3
	title = mem_lotc.3.name
	desc = mem_lotc.3.desc
	picture = GFX_evt_ship_in_orbit
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_country_flag = mem_lotc_going_for_it
			NOT = { has_country_flag = mem_lotc_found_the_second }
		}
		from = {
			has_star_flag = mem_lotc_second
			NOT = { 
				any_ship_in_system = {
					has_ship_flag = mem_lotc_disabled_cruiser
				}
			}
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = mem_lotc_found_the_second
		}
	}
	
	option = {
		name = OK
	}
}

#On action: cruiser taken out



#Third set: gas giant
ship_event = {
	id = mem_lotc.4
	title = mem_lotc.4.name
	desc = mem_lotc.4.desc
	
	is_triggered_only = yes
	
	picture = GFX_evt_mem_horror_corridor
	
	option = {
		name = mem_lotc.2a
		
		owner = {
			add_event_chain_counter = {
				event_chain = "mem_lotc_first_chain" 
				counter = mem_lotc_clues 
				amount = 1 
			}
			
			add_monthly_resource_mult = {
				resource = physics_research
				value = @tier3researchreward
				min = @tier3researchmin
				max = @tier3researchmax
			}
		}
	}
}

#Fourth set: barren
ship_event = {
	id = mem_lotc.5
	title = mem_lotc.5.name
	desc = mem_lotc.5.desc
	
	is_triggered_only = yes
	
	picture = GFX_evt_mem_horror_corridor
	
	option = {
		name = mem_lotc.2a
		
		owner = {
			add_event_chain_counter = {
				event_chain = "mem_lotc_first_chain" 
				counter = mem_lotc_clues 
				amount = 1 
			}
		}
	}
}

#Ship disabled: Event for NPC
ship_event = {
	id = mem_lotc.6
	
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_ship_flag = mem_lotc_cruiser
	}
	
	immediate = {
		set_ship_flag = mem_lotc_disabled_cruiser
		IF = {
			limit = {
				from.owner = {
					has_country_flag = mem_lotc_going_for_it
				}
			}
			from.owner = {
				set_country_flag = mem_lotc_shot_cruiser
				country_event = {
					id = mem_lotc.7
				}
			}
			else = {
				IF = {
					limit = {
						any_country = {
							limit = {
								has_country_flag = mem_lotc_found_the_second
							}
						}
					}
					every_country = {
						limit = {
							has_country_flag = mem_lotc_found_the_second
						}
						country_event = {
							id = mem_lotc.8
						}
					}
				}
			}
		}
	}
}

#Notified, if the player shot it
country_event = {
	id = mem_lotc.7
	title = mem_lotc.7.name
	desc = mem_lotc.7.desc
	
	is_triggered_only = yes
	
	picture = GFX_evt_exploding_ship
	
	option = {
		name = mem_lotc.7a
		
		from = {
			enable_special_project = {
				name = "MEM_BOARDING_CRUISER"
				location = this
				owner = root
			}
		}
	}
}

#Notified, player didn't take it out, but was aware of it
country_event = {
	id = mem_lotc.8
	title = mem_lotc.8.name
	desc = mem_lotc.8.desc
	
	is_triggered_only = yes
	
	picture = GFX_evt_exploding_ship
	
	option = {
		name = mem_lotc.8a
		
		from = {
			enable_special_project = {
				name = "MEM_BOARDING_CRUISER"
				location = this
				owner = root
			}
		}
	}
}

#on_action: Entered the system and found ship disabled
ship_event = {
	id = mem_lotc.9
	title = mem_lotc.9.name
	desc = mem_lotc.9.desc
	picture = GFX_evt_ship_in_orbit
	
	is_triggered_only = yes
	
	trigger = {
		owner = {
			has_country_flag = mem_lotc_going_for_it
			NOT = { has_country_flag = mem_lotc_found_the_second }
		}
		from = {
			has_star_flag = mem_lotc_second
			
			any_ship_in_system = {
				has_ship_flag = mem_lotc_disabled_cruiser
			}
			
		}
	}
	
	immediate = {
		owner = {
			set_country_flag = mem_lotc_found_the_second
		}
	}
	
	option = {
		name = mem_lotc.9a
		
		from.random_fleet_in_system = {
			limit = {
				has_fleet_flag = mem_lotc_cruiser
			}
			
			enable_special_project = {
				name = "MEM_BOARDING_CRUISER"
				location = this
				owner = root
			}
		}
	}
}