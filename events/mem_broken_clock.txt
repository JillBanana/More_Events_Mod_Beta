#Broken Clock
#By ViolentBeetle

namespace = mem_broken_clock

#Graphic test event - transformation

planet_event = {
    id = mem_broken_clock.9999
    hide_window = yes
    is_triggered_only = yes

    immediate = {
        change_pc = pc_a_star
        solar_system = {
            IF = {
                limit = {
                    exists = starbase
                }
                starbase = {
                    delete_ship = this
                }
            }
            random_system_planet = {
                limit = {
                    has_planet_flag = mem_broken_clock_homeworld
                }
                random_list = {
                    33 = {
                        change_pc = pc_ocean
                    }
                    33 = {
                        change_pc = pc_arid
                    }
                    33 = {
                        change_pc = pc_tundra
                    }
                }
                random_list = {
                    33 = {
                        create_species = {
                            name = Rakkan
                            plural = Rakkans
                            adjective = Rakkan
                            class = MAM
                            portrait = mam14
                            name_list = MAM4
                            traits = {
                                trait = trait_strong
                                trait = trait_industrious
                                trait = trait_fleeting
                            }
                            homeworld = this
                        }
                        create_country = {
                            type = default
                            name = "Dool'Rakkan Reborn"
                            species = last_created_species
                            name_list = MAM4
                            ethos = {
                                ethic = ethic_fanatic_xenophobe
                                ethic = ethic_militarist
                            }
                            authority = auth_imperial
                            civics = {
                                civic = civic_fanatic_purifiers
                                civic = civic_warrior_culture
                                civic = civic_distinguished_admiralty
                            }
                            effect = {
                                save_event_target_as = unwelcome_guests
                                mem_broken_clock_give_tech = yes
                                add_modifier = {
                                    modifier = mem_broken_clock_ai_cheat
                                    days = -1
                                }
                                add_influence = 1000
                                add_minerals = 5000
                                add_energy = 5000
                                add_food = 200
                                add_100_unity_per_year_passed = yes
                            }
                        }
                    }
                    33 = {
                        create_species = {
                            name = SEI
                            plural = SEI
                            adjective = SEI
                            class = MACHINE
                            portrait = random
                            name_list = MACHINE2
                            traits = {
                                trait = trait_machine_unit
                                trait = trait_robot_recycled
                                trait = trait_robot_mass_produced
                            }
                            homeworld = this
                        }
                        create_country = {
                            type = default
                            name = "Sustained Eradication Initiative"
                            species = last_created_species
                            name_list = MACHINE2
                            ethos = {
                                ethic = ethic_gestalt_consciousness
                            }
                            authority = auth_machine_intelligence
                            civics = {
                                civic = civic_machine_terminator
                                civic = civic_machine_rockbreakers
                                civic = civic_machine_replication
                            }
                            effect = {
                                save_event_target_as = unwelcome_guests
                                mem_broken_clock_give_tech = yes
                                add_modifier = {
                                    modifier = mem_broken_clock_ai_cheat
                                    days = -1
                                }
                                add_influence = 1000
                                add_minerals = 5000
                                add_energy = 5000
                                add_food = 200
                                add_100_unity_per_year_passed = yes
                            }
                        }

                        modifier = {
                            factor = 0
                            NOT = { host_has_dlc = "Synthetic Dawn Story Pack" }
                        }
                    }
                    33 = {
                        create_species = {
                            name = Apex
                            plural = Apices
                            adjective = Apexi
                            class = MOL
                            portrait = mol6
                            name_list = HIVE
                            traits = {
                                trait = trait_hive_mind
                                trait = trait_adaptive
                                trait = trait_strong
                                trait = trait_repugnant
                            }
                            homeworld = this
                        }
                        create_country = {
                            type = default
                            name = "Apex Organism"
                            species = last_created_species
                            name_list = HIVE
                            ethos = {
                                ethic = ethic_gestalt_consciousness
                            }
                            authority = auth_hive_mind
                            civics = {
                                civic = civic_hive_devouring_swarm
                                civic = civic_hive_strength_of_legions
                                civic = civic_hive_subspace_ephapse
                            }
                            effect = {
                                save_event_target_as = unwelcome_guests
                                mem_broken_clock_give_tech = yes
                                add_modifier = {
                                    modifier = mem_broken_clock_ai_cheat
                                    days = -1
                                }
                                add_influence = 1000
                                add_minerals = 5000
                                add_energy = 5000
                                add_food = 200
                                add_100_unity_per_year_passed = yes
                            }
                        }
                    }
                }
                prev = {
                    create_starbase = {
                        owner = event_target:unwelcome_guests
                        size = starbase_starfortress
                        module = shipyard
                        module = shipyard
                        module = anchorage
                        module = anchorage
                        module = gun_battery
                        module = missile_battery

                        building = crew_quarters
                        building = target_uplink_computer
                        building = listening_post
                        effect = {
                            while = {
                                count = 6
                                create_ship = {
                                    name = random
                                    random_existing_design = military_station_small
                                }
                            }
                        }
                    }
                }
                set_owner = event_target:unwelcome_guests
                every_tile = {
                    create_pop = {
                        species = event_target:unwelcome_guests
                    }
                }
                random_tile = {
                    limit = {
                        num_adjacent_tiles > 3
                        has_building = no
                    }
                    set_building = building_capital_3
                }
                random_tile = {
                    limit = {
                        has_building = no
                    }
                    set_building = building_power_hub_1
                }
                random_tile = {
                    limit = {
                        has_building = no
                        NOT = {
                            any_neighboring_tile = {
                                OR = {
                                    has_building = "building_capital_1"
                                    has_building = "building_capital_2"
                                    has_building = "building_capital_3"
                                }
                            }
                        }
                    }
                    set_building = building_stronghold
                }
                random_tile = {
                    limit = {
                        has_building = no
                        NOT = {
                            any_neighboring_tile = {
                                OR = {
                                    has_building = "building_capital_1"
                                    has_building = "building_capital_2"
                                    has_building = "building_capital_3"
                                }
                            }
                        }
                    }
                    set_building = building_hypercomms_forum
                }
                random_tile = {
                    limit = {
                        has_building = no
                        any_neighboring_tile = {
                            OR = {
                                has_building = "building_capital_1"
                                has_building = "building_capital_2"
                                has_building = "building_capital_3"
                            }
                        }
                    }
                    set_building = building_dark_matter_power_plant
                }
                random_tile = {
                    limit = {
                        has_building = no
                        any_neighboring_tile = {
                            OR = {
                                has_building = "building_capital_1"
                                has_building = "building_capital_2"
                                has_building = "building_capital_3"
                            }
                        }
                    }
                    set_building = building_ancient_factory
                }
                mem_broken_clock_set_buildings = yes
            }

            every_system_planet = {
                limit = {
                    has_planet_flag = mem_broken_clock_mining_moon
                }
                change_pc = pc_barren
                orbital_deposit_tile = {
                    set_deposit = d_immense_energy_deposit
                    add_deposit = d_immense_mineral_deposit
                    add_deposit = d_energy_deposit
                    add_deposit = d_mineral_deposit
                }
                create_mining_station = {
                    owner = event_target:unwelcome_guests
                }
            }

            every_system_planet = {
                limit = {
                    is_planet_class = pc_ringworld_habitable_damaged
                }
                change_pc = pc_ringworld_habitable
                set_owner = event_target:unwelcome_guests
                every_tile = {
                    create_pop = {
                        species = event_target:unwelcome_guests
                    }
                }
                random_tile = {
                    limit = {
                        num_adjacent_tiles > 3
                        has_building = no
                    }
                    set_building = building_capital_2
                }
                random_tile = {
                    limit = {
                        has_building = no
                    }
                    set_building = building_power_hub_1
                }
                random_tile = {
                    limit = {
                        has_building = no
                        NOT = {
                            any_neighboring_tile = {
                                OR = {
                                    has_building = "building_capital_1"
                                    has_building = "building_capital_2"
                                    has_building = "building_capital_3"
                                }
                            }
                        }
                    }
                    set_building = building_stronghold
                }
                random_tile = {
                    limit = {
                        has_building = no
                        NOT = {
                            any_neighboring_tile = {
                                OR = {
                                    has_building = "building_capital_1"
                                    has_building = "building_capital_2"
                                    has_building = "building_capital_3"
                                }
                            }
                        }
                    }
                    set_building = building_hypercomms_forum
                }
                mem_broken_clock_set_buildings = yes
            }
            every_system_planet = {
                limit = {
                    is_planet_class = pc_ringworld_tech_damaged
                }
                change_pc = pc_ringworld_tech
            }
            every_system_planet = {
                limit = {
                    is_planet_class = pc_ringworld_seam_damaged
                }
                change_pc = pc_ringworld_seam
            }
            event_target:unwelcome_guests = {
                while = {
                    count = 5
                    random_owned_planet = {
                        prev = { create_fleet_from_naval_cap = 0.05 }
                        last_created_fleet = {
                            set_location = prev
                        }
                    }
                }
                country_event = { id = game_start.9 }
            }
        }
    }
}